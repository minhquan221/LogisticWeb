@using LogisticWeb.Common
@model ModelHelper.ViewModel.ImportFileDetailViewModel
@{
    ViewBag.Title = "LamipelVN | Import File";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-container">

    <!-- BEGIN SIDEBAR -->

    @Html.Action("MenuSiteBar", "Common")

    <!-- END SIDEBAR -->
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <div id="contentbody" class="container-fluid">
            <!-- BEGIN PAGE HEADER-->
            <div class="row-fluid">
                <div class="span12">
                    <h3 class="page-title">
                        New Import File
                        <small></small>
                    </h3>
                    <ul class="breadcrumb sitemap"></ul>
                </div>
            </div>
            <!-- END PAGE HEADER-->
            <!-- BEGIN PAGE CONTENT-->
            <div class="row-fluid">
                <div class="span12">
                    <div class="portlet box blue">
                        <div class="portlet-title">
                            <div class="caption"><i class="icon-reorder"></i>Detail Import File</div>
                            <div class="tools">
                                <a href="javascript:;" class="collapse"></a>
                            </div>
                        </div>
                        <div id="detail" class="portlet-body form">
                            @*<input hidden name="ID" />*@
                            <!-- BEGIN FORM-->
                            <div class="form-horizontal">
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Import File No.:</label>
                                        <div class="controls">
                                            <input type="hidden" name="ID" value="@Model.ID" />
                                            <input name="IMPFILE" value="@Model.IMPFILE" autocomplete="off" type="text" class="span6 m-wrap" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Contract No.:</label>
                                        <div class="controls">
                                            <select disabled id="IMPORTCONTRACTCODE" name="IMPORTCONTRACTCODE" data-value="IMPORTCODE" data-name="IMPORTCODE" ajaxurl="/importcon/getlist" class="span6" data-selected="@Model.IMPORTCONTRACTCODE"></select>
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Packages:</label>
                                        <div class="controls">
                                            <input name="TOTALPALLET" value="" disabled autocomplete="off" type="text" class="span6 m-wrap" />
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">No. of Cnt:</label>
                                        <div class="controls">
                                            <input name="QUANTITYPKL" initvalue="@Model.QUANTITYPKL" autocomplete="off" type="number" class="span6 m-wrap" value="@Model.QUANTITYPKL" />
                                            <span class="approximateunit" name="cnttype"></span>
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">ETD:</label>
                                        <div class="controls">
                                            <input readonly name="ETD" value="@(Model.ETD.HasValue ? Model.ETD.Value.ToString("yyyy-MM-dd") : "")" autocomplete="off" type="text" class="span6 m-wrap" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Total PCS:</label>
                                        <div class="controls">
                                            <input name="TOTALPCS" value="" disabled autocomplete="off" type="text" class="span6 m-wrap" />
                                            <span class="approximateunit">PCS</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">BL Number:</label>
                                        <div class="controls">
                                            <input name="BLNO" autocomplete="off" type="text" class="span6 m-wrap" value="@Model.BLNO" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">ETA:</label>
                                        <div class="controls">
                                            <input readonly name="ETA" autocomplete="off" type="text" class="span6 m-wrap" value="@(Model.ETA.HasValue ? Model.ETA.Value.ToString("yyyy-MM-dd") : "")" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Total NW:</label>
                                        <div class="controls">
                                            <input name="TOTALNW" value="" disabled autocomplete="off" type="text" class="span6 m-wrap" />
                                            <span class="approximateunit">KGS</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Invoice:</label>
                                        <div class="controls">
                                            <input name="INVOICE" autocomplete="off" type="text" class="span6 m-wrap" value="@Model.INVOICE" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">ETIH:</label>
                                        <div class="controls">
                                            <input readonly name="INHOUSEDATE" autocomplete="off" type="text" class="span6 m-wrap" value="@(Model.INHOUSEDATE.HasValue ? Model.INHOUSEDATE.Value.ToString("yyyy-MM-dd") : "")" />
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Total SQFT:</label>
                                        <div class="controls">
                                            <input name="TOTALSQFT" value="" disabled autocomplete="off" type="text" class="span6 m-wrap" />
                                            <span class="approximateunit">SQFT</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Invoice Value:</label>
                                        <div class="controls">
                                            <input name="INVOICEVALUE" disabled autocomplete="off" type="number" class="span6 m-wrap" value="@Model.INVOICEVALUE" />
                                            <span class="approximateunit">USD</span>
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">Paid value:</label>
                                        <div class="controls">
                                            <input name="PAIDVALUE" autocomplete="off" type="number" class="span6 m-wrap" value="@Model.PAIDVALUE" />
                                            <span class="approximateunit">USD</span>
                                        </div>
                                    </div>
                                    <div class="controls-left-30 nosize">
                                        <label class="control-label">LWG:</label>
                                        <div class="controls">
                                            <input name="ISLWG" class="span12" @(Model.ISLWG ? "checked" : "") style="min-height: 22px;" type="checkbox" />
                                            @*<input name="LWG" value="@Model.LWG" type="text" class="span6 m-wrap" />*@
                                        </div>
                                    </div>
                                </div>
                                <input onchange="UploadFileExcelAll(this)" name="fileuploadall" type="file" style="display: none;" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
                                <div class="control-group">
                                    <div class="controls-left-30 nosize">
                                        <button onclick="UploadAllClick()" class="btn">
                                            Upload Container Info <i class="icon-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="control-group" style="display: none;">
                                    <div class="controls-left-50 nosize">
                                        <button onclick="AddNewPKL()" class="btn">
                                            Add Cnt <i class="icon-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- END FORM-->
                        </div>
                    </div>
                </div>
            </div>
            @{
                if (Model.ListContainer != null && Model.ListContainer.Count > 0)
                {
                    int indexCnt = 0;
                    foreach (var item in Model.ListContainer)
                    {
                        indexCnt++;
                        decimal sumAVG = item.PalletList == null ? 0 : item.PalletList.Sum(x => (x.NW.HasValue ? x.NW.Value : 0));
                        decimal sumSAVG = item.PalletList == null ? 0 : item.PalletList.Sum(x => (x.SQFT.HasValue ? x.SQFT.Value : 0));
                        decimal sumPCS = item.PalletList == null ? 0 : item.PalletList.Sum(x => (x.PCS.HasValue ? x.PCS.Value : 0));
                        decimal AVGWAVG = item.PalletList == null ? 0 : sumAVG / sumPCS;
                        decimal AVGSAVG = item.PalletList == null ? 0 : sumSAVG / sumPCS;
                        long seQ = 0;
                        if (item.PalletList != null && item.PalletList.Count > 0)
                        {
                            foreach (var pall in item.PalletList)
                            {
                                var seQname = pall.NAME.Split('-')[pall.NAME.Split('-').Length - 1];
                                long temp = Convert.ToInt64(seQname);
                                if (temp > seQ)
                                {
                                    seQ = temp;
                                }
                            }
                        }
                        string noSeQ = seQ.ToString();
                        <div name="containeritem" class="row-fluid span6" pklid="pkl_@indexCnt">
                            <div class="span12 noleft">
                                <div class="portlet box blue">
                                    <div class="portlet-title">
                                        <input onchange="UploadFileExcel(this)" name="fileupload" type="file" style="display: none;" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
                                        <div class="caption"><i class="icon-reorder"></i>Cnt No. @item.PKLNAME</div>
                                        <div class="tools">
                                            <a href="javascript:void(0);" class="collapse"></a>
                                            <a href="javascript:void(0);" class="remove" onclick="RemoveCnt(this, '@item.ID')"></a>
                                        </div>
                                        <div name="uploadimportpallet" style="float: right;margin-right: 10px;" onclick="UploadClick(this);">
                                            <span class="icon-upload-alt"></span>
                                        </div>
                                        <div name="printimportpallet" style="float: right;margin-right: 10px;" onclick="PrintImportPallet(this)"><span class="icon-print"></span></div>
                                    </div>

                                    <div id="palletlist" class="portlet-body form">
                                        <input name="NoSEQ" type="hidden" value="@noSeQ" />
                                        <div class="form-horizontal">
                                            <div class="control-group">
                                                <div class="controls-left-50 nosize">
                                                    <label class="control-label">PKL Code:</label>
                                                    <div class="controls">
                                                        <input type="hidden" name="CNTID" value="@item.ID" />
                                                        <input name="PKLIDENTITY" autocomplete="off" type="text" class="span6 m-wrap" value="@item.PKLIDENTITY" />
                                                        <input name="PKLNAME" type="hidden" value="@item.PKLNAME" />
                                                        <input name="PKLDONECODE" type="hidden" value="@item.PKLDONECODE" />
                                                        @*<span class="icon-refresh refresh-btn" style="font-size: 15px;margin-top: 10px;"></span>*@
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <!-- BEGIN FORM-->
                                            <table class="table table-striped table-bordered table-hover middlevertical importpallet">
                                                <thead>
                                                    <tr>
                                                        <th>No.</th>
                                                        <th>Pallet Code</th>
                                                        <th style="width:190px;">Material</th>
                                                        <th style="width:33px;">PCS</th>
                                                        <th style="width:50px;">NW</th>
                                                        <th style="width:50px;">SQFT</th>
                                                        <th style="width:50px;">AVG</th>
                                                        <th style="width:50px;">SAVG</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr name="avgrow" style="font-weight: bold; font-size: 13px; background-color: #e4f3f5 !important;">
                                                        <td colspan="3"><span style="text-align:right;">AVERAGE</span></td>
                                                        @*<td></td>
                                                            <td></td>
                                                            <td></td>*@
                                                        <td></td>
                                                        <td>
                                                            <span name="avg">@AVGWAVG.FormatDecimal(1)</span>
                                                        </td>
                                                        <td>
                                                            <span name="savg">@AVGSAVG.FormatDecimal(1)</span>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>
                                                    <tr name="inputrow">
                                                        <td></td>
                                                        <td>
                                                            <!--<input name="PKLNAME" type="text" class="span12" />-->
                                                        </td>
                                                        <td>
                                                            <select data-value="MERGEID" data-name="MATERIALFULL" ajaxurl="/material/getlistforimpfilefull" name="MATERIALFULL" class="span12"></select>
                                                            <input type="hidden" name="OVERUNIT" />
                                                            <input type="hidden" name="PRICE" />
                                                            <input type="hidden" name="ITEMCODE" />
                                                        </td>
                                                        <td>
                                                            <input autocomplete="off" name="PCS" type="text" class="span12" />
                                                        </td>
                                                        <td>
                                                            <input autocomplete="off" name="NW" type="text" class="span12" />
                                                        </td>
                                                        <td>
                                                            <input autocomplete="off" name="SQFT" type="text" class="span12" />
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <button name="saverowbtn" type="button" style="cursor: pointer;">
                                                                <span onclick="AddRowPallet(this)" class="icon-plus"></span>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    @if (item.PalletList != null)
                                                    {
                                                        int indexPallet = 0;
                                                        foreach (var pallet in item.PalletList)
                                                        {
                                                            indexPallet++;
                                                            <tr name="outputrow">
                                                                <td><input type="hidden" name="INDEXPKL" value="@indexPallet" />@indexPallet</td>
                                                                <td>
                                                                    <input type="hidden" name="PALLETID" value="@pallet.ID" />
                                                                    <input type="hidden" name="NAME" value="@pallet.NAME" />
                                                                    <input type="hidden" name="PRICEPALLET" value="@pallet.PRICEPALLET" />
                                                                    <input type="hidden" name="ITEMCONTRACTCODE" value="@pallet.ITEMCONTRACTCODE" />
                                                                    <input type="hidden" name="PALLETDONECODE" value="@pallet.PALLETDONECODE" />
                                                                    @(pallet.NAME.Split('-')[pallet.NAME.Split('-').Length - 1])
                                                                </td>
                                                                <td><input type="hidden" name="SELECTEDSUBMATERIAL" value="@pallet.SUBMATERIALID" /><input type="hidden" name="SELECTEDMATERIAL" value="@pallet.MATERIALID" />@(pallet.MATERIALNAME + " " + pallet.SUBMATERIALNAME)</td>
                                                                <td><input type="hidden" name="PCS" value="@pallet.PCS" />@pallet.PCS.FormatDecimal()</td>
                                                                <td><input type="hidden" name="NW" value="@pallet.NW" /><input type="hidden" name="WAVG" value="@pallet.WAVG" />@pallet.NW.FormatDecimal()</td>
                                                                <td><input type="hidden" name="SQFT" value="@pallet.SQFT" /><input type="hidden" name="SAVG" value="@pallet.SAVG" />@pallet.SQFT.FormatDecimal()</td>
                                                                <td>@((pallet.PCS.HasValue && pallet.PCS.Value != 0 ? (pallet.NW.HasValue ? pallet.NW.Value : 0) / pallet.PCS : 0).FormatDecimal(1))</td>
                                                                <td>@((pallet.PCS.HasValue && pallet.PCS.Value != 0 ? (pallet.SQFT.HasValue ? pallet.SQFT.Value : 0) / pallet.PCS : 0).FormatDecimal(1))</td>
                                                                <td><button type="button" style="cursor: pointer;"><span onclick="RemovePallet(this)" class="icon-minus"></span></button></td>
                                                            </tr>
                                                        }
                                                    }
                                                </tbody>
                                                <tfoot>
                                                    <tr name="totalrow" style="font-weight: bold; font-size: 13px;background-color: #e4f3f5 !important;">
                                                        <td colspan="3"><span style="text-align:right;">TOTAL</span></td>
                                                        @*<td></td>
                                                            <td></td>
                                                            <td></td>*@
                                                        <td>
                                                            <span name="totalpcs">@sumPCS.FormatDecimal(1)</span>
                                                        </td>
                                                        <td>
                                                            <span name="totalavg">@sumAVG.FormatDecimal(1)</span>
                                                        </td>
                                                        <td>
                                                            <span name="totalsavg">@sumSAVG.FormatDecimal(1)</span>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                            <!-- END FORM-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        if (indexCnt % 2 == 0)
                        {
                            <div name="fixlistpkl" class="clearfix"></div>
                        }
                    }
                }
            }


            <div class="row-fluid" id="actioncontent">
                <div class="span12">
                    <div class="portlet box blue no-border">
                        <div class="portlet-body form">
                            <div class="form-actions no-border">
                                <button type="button" onclick="UpdateImportFileContract()" class="btn blue" style="width: 200px;">Save<br />Lưu</button>
                                <button type="button" style="width: 92px;" class="btn" onclick="location.href = '/importfile'">Cancel<br />Hủy</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END PAGE CONTENT-->
        </div>
        <!-- END PAGE -->
    </div>
</div>

@section styles{
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-fileupload/bootstrap-fileupload.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/chosen-bootstrap/chosen/chosen.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/select2/select2_metro.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/clockface/css/clockface.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-datepicker/css/datepicker.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-timepicker/compiled/timepicker.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-colorpicker/css/colorpicker.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-toggle-buttons/static/stylesheets/bootstrap-toggle-buttons.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/bootstrap-datetimepicker/css/datetimepicker.css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/jquery-multi-select/css/multi-select-metro.css" />
    <link href="/Content/assets/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />
    <link href="/Content/assets/plugins/bootstrap-switch/static/stylesheets/bootstrap-switch-metro.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/Content/assets/plugins/jquery-tags-input/jquery.tagsinput.css" />
    <link href="~/Content/jqueryUi.css" rel="stylesheet" />
    @*<link href="~/Content/stylesheet.css" rel="stylesheet" />*@
    <!-- END PAGE LEVEL STYLES -->
    <style>
        .approximateunit {
            margin-left: -35px;
        }

        .table-striped tbody > tr:nth-child(odd) > td, .table-striped tbody > tr:nth-child(odd) > th {
            background-color: unset;
        }
    </style>
}

@section scripts{
    <!-- BEGIN PAGE LEVEL SCRIPTS -->
    <script src="~/Content/assets/plugins/uniform/jquery.uniform.js"></script>
    <script src="~/Scripts/Common/customsuggest.js"></script>
    <script src="~/Scripts/Common/customvalidate.js"></script>
    <script src="~/Scripts/Common/customselect.js"></script>
    <!-- END PAGE LEVEL SCRIPTS -->
    <script type="text/javascript">
        //var countListItem = $('#itemlist').find('div[name=item]').length;
        var countListPKL = 0;
        var countListPallet = 0;
    </script>
    <script src="~/Scripts/business/impfile.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('input[name=ETA]').datepicker({
                "autoclose": true,
                format: 'yyyy-MM-dd',
            });
            $('input[name=ETD]').datepicker({
                "autoclose": true,
                format: 'yyyy-MM-dd',
            });
            $('input[name=INHOUSEDATE]').datepicker({
                "autoclose": true,
                format: 'yyyy-MM-dd',
            });
            $('input[name=QUANTITYPKL]').on('blur', async function () {
                await AutoInitContainer($(this));
            });
            $('input[name=IMPFILE]').on('blue, change', function () {
                UpdateDateIMP();
            });
            InitDetailData();
            ReCallTotal();
            //CalcTotalforImp();
            //LoadListCustomer();
            //LoadListConsignee();
            //LoadContractCodeName();
            //LoadListDeliveryMethod();
            //LoadListContainerType();
            //$('input[name=DELIVERYPLAN]').datepicker({
            //    "autoclose": true,
            //    format: 'yyyy-MM-dd',
            //});
            //$('input[name=DomesticCheck]').uniform();
        })
    </script>
}
